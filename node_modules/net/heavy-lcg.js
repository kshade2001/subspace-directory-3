/*
    Subspace Directory 3
    Copyright (C) 2015 Kingsley Masters
    Email: kingsley at flabbyfish.co.uk

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

//CONVERTED FROM CATID's MERV BOT (www.mervbot.com)


/*jslint node: true */
"use strict";

var BigInt = require("big-integer");

var HeavyLcg = function (seed) {
    this._KSGSCD = BigInt(0x1F31D);
    this._KSGSCM = 2202930015;
    this._seed = BigInt(seed || 0);
};

HeavyLcg.prototype.seed = function(seed) {
    this._seed = BigInt(seed || 0);
}

HeavyLcg.prototype.getNextEncryption = function () {
    var old_seed = this._seed;
    
    this._seed = old_seed.multiply(this._KSGSCM).shiftRight(48);
    this._seed = this._seed.plus(this._seed.shiftRight(31));
    this._seed = old_seed.mod(this._KSGSCD).multiply(16807).minus(this._seed.multiply(2836)).plus(123);
    
    if(this._seed.greater(0x7FFFFFFF)) {
        this._seed = this._seed.plus(0x7FFFFFFF);
    }
    return this._seed.and(0xFFFF).toJSNumber();
};

module.exports = HeavyLcg;